!function(e){var t={};function i(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(n,r,function(t){return e[t]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="dist",i(i.s=2)}([function(e,t,i){(function(e){function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var i;i={compressionlevel:-1,height:17,infinite:!1,layers:[{data:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,1,1,0,0,0,0,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,1,1,1,1,1,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1],height:17,id:1,name:"tiles",opacity:1,type:"tilelayer",visible:!0,width:36,x:0,y:0},{draworder:"topdown",id:2,name:"actors",objects:[{gid:3,height:32,id:1,name:"",rotation:0,type:"",visible:!0,width:32,x:96,y:480},{gid:2,height:32,id:2,name:"",rotation:0,type:"",visible:!0,width:32,x:461,y:480},{gid:4,height:32,id:3,name:"",rotation:0,type:"",visible:!0,width:32,x:207.333333333333,y:368},{gid:5,height:32,id:10,name:"",rotation:0,type:"",visible:!0,width:32,x:352,y:160},{gid:5,height:32,id:11,name:"",rotation:0,type:"",visible:!0,width:32,x:544,y:256},{gid:5,height:32,id:12,name:"",rotation:0,type:"",visible:!0,width:32,x:608,y:256},{gid:5,height:32,id:13,name:"",rotation:0,type:"",visible:!0,width:32,x:64,y:224},{gid:5,height:32,id:14,name:"",rotation:0,type:"",visible:!0,width:32,x:768,y:352},{gid:2,height:32,id:15,name:"",rotation:0,type:"",visible:!0,width:32,x:736,y:448},{gid:5,height:32,id:17,name:"",rotation:0,type:"",visible:!0,width:32,x:320,y:480},{gid:5,height:32,id:18,name:"",rotation:0,type:"",visible:!0,width:32,x:640,y:480},{gid:6,height:32,id:19,name:"",rotation:0,type:"",visible:!0,width:32,x:240,y:464},{gid:6,height:32,id:20,name:"",rotation:0,type:"",visible:!0,width:32,x:352,y:240},{gid:6,height:32,id:21,name:"",rotation:0,type:"",visible:!0,width:32,x:107.333333333333,y:339},{gid:6,height:32,id:22,name:"",rotation:0,type:"",visible:!0,width:32,x:607.666666666667,y:400},{gid:6,height:32,id:23,name:"",rotation:0,type:"",visible:!0,width:32,x:145,y:455},{gid:2,height:32,id:24,name:"",rotation:0,type:"",visible:!0,width:32,x:832,y:448},{gid:2,height:32,id:25,name:"",rotation:0,type:"",visible:!0,width:32,x:576,y:320}],opacity:1,type:"objectgroup",visible:!0,x:0,y:0}],nextlayerid:3,nextobjectid:129,orientation:"orthogonal",renderorder:"right-down",tiledversion:"1.3.3",tileheight:32,tilesets:[{firstgid:1,source:"../../../../../maps/tileset.tsx"}],tilewidth:32,type:"map",version:1.2,width:36},"undefined"==typeof onTileMapLoaded?("undefined"==typeof TileMaps&&(TileMaps={}),TileMaps.level2=i):onTileMapLoaded("level2",i),"object"===t(e)&&e&&e.exports&&(e.exports=i)}).call(this,i(1)(e))},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,i){"use strict";function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}i.r(t);var r=function(){function e(t,i,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.states={},this.activeState=null,this.canvas=t,this.ctx=this.canvas.getContext("2d"),this.gameWidth=this.canvas.width,this.gameHeight=this.canvas.height,this.maps=this.parseMaps(i),this.currentLevel=0,this.config=n,(new Image).src="/img/bg/4.jpg"}var t,i,r;return t=e,(i=[{key:"addState",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.states[e]=new t(this,i)}},{key:"runState",value:function(e){this.activeState=e,this.run()}},{key:"changeState",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.activeState=e,this.states[this.activeState].create(this,t)}},{key:"run",value:function(){var e=this;!function t(){e.ctx.clearRect(0,0,e.gameWidth,e.gameHeight);var i=performance.now();e.states[e.activeState].update(e),e.states[e.activeState].render(e),i=performance.now()-i,e.config.scriptTime&&console.log("Время выполнения = ",i),window.requestAnimationFrame(t)}()}},{key:"parseMaps",value:function(e){var t=[];return e.forEach((function(e){for(var i={tiles:[],actors:[]},n=e.layers.find((function(e){return"tiles"===e.name})),r=n.data,a=n.width,o=n.height,s=0;s<o;s++){for(var l=[],c=0;c<a;c++)l.push(r[s*a+c]);i.tiles.push(l)}e.layers.find((function(e){return"actors"===e.name})).objects.forEach((function(e){i.actors.push(e)})),t.push(i)})),t}}])&&n(t.prototype,i),r&&n(t,r),e}();function a(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var o=function(){function e(t,i){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),addEventListener("keyup",(function(e){83===e.keyCode&&t.states[t.activeState]===n&&t.changeState("game")}))}var t,i,n;return t=e,(i=[{key:"update",value:function(){}},{key:"render",value:function(e){var t=e.ctx;t.font="18px Arial",t.fillStyle="white",t.textAlign="center",t.fillText('Нажмите "S", чтобы начать игру.',e.canvas.width/2,e.canvas.height/2)}}])&&a(t.prototype,i),n&&a(t,n),e}();function s(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var l=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.x=t,this.y=i}var t,i,n;return t=e,(i=[{key:"plus",value:function(t){return new e(this.x+t.x,this.y+t.y)}},{key:"times",value:function(t){return new e(this.x*t,this.y*t)}}])&&s(t.prototype,i),n&&s(t,n),e}();function c(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var h=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.animations=[],this.animationInterval=null,this.currentFrame=0,this.rotation=1}var t,i,n;return t=e,(i=[{key:"setSprite",value:function(e,t){this.image=new Image,this.image.src="/img/actors/".concat(e),this.spriteSize=t}},{key:"setAnimation",value:function(e,t,i){this.animations[e]={frames:t,speed:i}}},{key:"getCurrentAnimation",value:function(){return this.activeAnimation}},{key:"playAnimation",value:function(e){var t=this;if(this.getCurrentAnimation()!==e){clearTimeout(this.animationInterval);var i=this.animations[e],n=i.frames.length;this.activeAnimation=e,this.currentFrame=i.frames[(this.currentFrame+1)%n],this.animationInterval=setInterval((function(){t.currentFrame=i.frames[(t.currentFrame+1)%n]}),i.speed)}}},{key:"draw",value:function(e,t){this.rotation>0?e.drawImage(this.image,this.currentFrame*this.spriteSize,0,this.spriteSize-1,this.spriteSize,this.pos.x*t.cellSize,this.pos.y*t.cellSize,this.spriteSize,this.spriteSize):(e.save(),e.scale(-1,1),e.drawImage(this.image,this.currentFrame*this.spriteSize,0,this.spriteSize-1,this.spriteSize,-this.pos.x*t.cellSize-this.size.x*t.cellSize,this.pos.y*t.cellSize,this.spriteSize,this.spriteSize),e.restore())}}])&&c(t.prototype,i),n&&c(t,n),e}(),u="black",f="yellow",p="#28ecec",y="white",v="blue",d="#1cec82",m="green";function b(e){return(b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function g(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function w(e,t){return!t||"object"!==b(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function S(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function x(e){return(x=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function k(e,t){return(k=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var z=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&k(e,t)}(o,e);var t,i,n,r,a=(t=o,function(){var e,i=x(t);if(S()){var n=x(this).constructor;e=Reflect.construct(i,arguments,n)}else e=i.apply(this,arguments);return w(this,e)});function o(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(t=a.call(this)).pos=e.plus(new l(.2,.2)),t.size=new l(.6,.6),t.speed=new l(0,0),t.color=u,t.touched=!1,t.hp=100,t.initialSpeed=6,t.speedX=t.initialSpeed,t.poisonTimer=0,t.setSprite("player.png",20),t.setAnimation("stand",[0,1],120),t.setAnimation("attacked",[2,3],120),t.setAnimation("poisoned",[4,5],120),t.playAnimation("stand"),t.initialOptions={jumpEnergy:15},t.gravity=28,t.jumped=!1,t.jumpForce=5,t.jumpsCount=1,t.jumpEnergy=t.initialOptions.jumpEnergy,t}return i=o,(n=[{key:"act",value:function(e,t){t.z?this.speedX=this.initialSpeed+2:this.speedX=this.initialSpeed,this.moveX(e,t),this.moveY(e,t);var i=e.actorAt(this);i&&this.collidesWithActors(e,[i]),this.poisonTimer>0?(this.poisonTimer-=1,this.hp-=.04,this.playAnimation("poisoned")):this.touched?this.playAnimation("attacked"):this.playAnimation("stand"),this.touched=!1,e.playerHp=this.hp}},{key:"moveX",value:function(e,t){this.speed.x=0,t.left&&(this.speed.x-=this.speedX,this.rotation=-1),t.right&&(this.speed.x+=this.speedX,this.rotation=1),e.updateCamera(this.pos.x);var i=new l(this.speed.x*e.step,0),n=this.pos.plus(i),r=e.obstacleAt(n,this.size);r.type?(this.collides(e,r.actors),this.speed.x>0?this.pos.x=r.pos.x-this.size.x:this.speed.x<0&&(this.pos.x=r.pos.x+1),this.speed.x=0):this.pos=n}},{key:"moveY",value:function(e,t){this.speed.y+=e.step*this.gravity;var i=new l(0,this.speed.y*e.step),n=this.pos.plus(i);n.y+this.size.y>e.height&&(e.status="lost"),!t.up&&this.jumped&&(this.jumpEnergy=0,this.jumped=!1,this.jumpsCount-=1);var r=e.obstacleAt(n,this.size);r.type?(this.collides(e,r.actors),this.jumpEnergy=0,this.speed.y>0?(this.jumped=!1,this.pos.y=r.pos.y-this.size.y,this.jumpEnergy=this.initialOptions.jumpEnergy,this.jumpsCount=2):this.pos.y=r.pos.y+1,this.speed.y=0,t.up&&!this.jumped&&this.jumpsCount>0&&(this.jumpEnergy=this.initialOptions.jumpEnergy,this.jumped=!0,this.speed.y=-this.jumpForce)):(t.up&&(!this.jumped&&this.jumpsCount>0&&(this.jumpEnergy=this.initialOptions.jumpEnergy,this.jumped=!0),this.jumpEnergy>0&&(this.speed.y=-this.jumpForce-2,this.jumpEnergy-=1)),this.pos=n)}},{key:"collidesWithActors",value:function(e,t){var i=this;t.forEach((function(t){switch(t.type){case"coin":e.actors=e.actors.filter((function(e){return e!==t})),e.actors.some((function(e){return"coin"===e.type}))||(e.status="win");break;case"sphere":t.activate(i);break;case"enemy":i.touched=!0,i.hp-=t.damage}})),this.hp<=0&&(e.status="lost")}},{key:"collides",value:function(e,t){var i=this;t.forEach((function(e){switch(e){case"lava":i.poisonTimer=1200,i.touched=!0,i.hp-=1}})),this.hp<=0&&(e.status="lost")}},{key:"debugDraw",value:function(e,t){}}])&&g(i.prototype,n),r&&g(i,r),o}(h),j="circle",P="square",O="coin",E="enemy",T="sphere";function M(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var A=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.pos=this.basePos=t.plus(new l(.25,.55)),this.size=new l(.5,.5),this.wobble=Math.random()*Math.PI*2,this.type=O,this.color=f,this.shape=P}var t,i,n;return t=e,(i=[{key:"act",value:function(e){this.wobble+=7*e.step;var t=.1*Math.sin(this.wobble);this.pos=this.basePos.plus(new l(0,t))}},{key:"draw",value:function(e,t){e.beginPath(),e.fillStyle=this.color,e.rect(this.pos.x*t.cellSize,this.pos.y*t.cellSize,this.size.x*t.cellSize,this.size.y*t.cellSize),e.fill()}},{key:"debugDraw",value:function(e,t){}}])&&M(t.prototype,i),n&&M(t,n),e}();function X(e){return(X="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function C(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _(e,t){return!t||"object"!==X(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function I(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function R(e){return(R=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function W(e,t){return(W=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var D=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&W(e,t)}(o,e);var t,i,n,r,a=(t=o,function(){var e,i=R(t);if(I()){var n=R(this).constructor;e=Reflect.construct(i,arguments,n)}else e=i.apply(this,arguments);return _(this,e)});function o(e,t){var i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(i=a.call(this)).pos=e,i.size=new l(1,1),i.speed=new l(1.3,0),i.damage=1,i.type=E,i.shape=P,i.color=u,i.setSprite("enemy.png",32),i.setAnimation("stand",[0,1],120),i.playAnimation("stand"),i}return i=o,(n=[{key:"act",value:function(e,t){this.moveX(e,t),this.moveY(e,t)}},{key:"moveX",value:function(e){var t=this.pos.plus(this.speed.times(e.step));e.obstacleAt(t,this.size).type?this.changeDirection():this.pos=t}},{key:"moveY",value:function(e){var t=this.speed.x>0?1:-1,i=this.pos.plus(new l(this.size.x*t,this.size.y));e.obstacleAt(i,this.size).type||this.changeDirection()}},{key:"changeDirection",value:function(){this.speed=this.speed.times(-1),this.rotation=Math.sign(this.speed.x)}},{key:"debugDraw",value:function(e,t){}}])&&C(i.prototype,n),r&&C(i,r),o}(h);function F(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var H=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.pos=this.basePos=t.plus(new l(0,.55)),this.size=new l(.25,.25),this.wobble=Math.random()*Math.PI*2,this.reloadTime=150,this.timer=-1,this.type=T,this.color=p,this.shape=j}var t,i,n;return t=e,(i=[{key:"act",value:function(e){this.wobble+=7*e.step;var t=.1*Math.sin(this.wobble);this.pos=this.basePos.plus(new l(0,t)),this.timer>-1&&(this.timer-=1)}},{key:"activate",value:function(e){-1===this.timer&&(e.jumpsCount+=1,this.timer=this.reloadTime)}},{key:"draw",value:function(e,t){e.globalAlpha=-1===this.timer?1:0,e.beginPath(),e.fillStyle=this.color,e.arc((this.pos.x+.5)*t.cellSize,(this.pos.y+.5)*t.size,4,0,2*Math.PI),e.fill(),e.globalAlpha=1}},{key:"debugDraw",value:function(e,t){}}])&&F(t.prototype,i),n&&F(t,n),e}();function Y(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var L=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.pos=t,this.size=new l(1,1),this.rotation=0,this.color=u,this.shape=j,this.type=E,this.damage=1}var t,i,n;return t=e,(i=[{key:"act",value:function(e){this.rotation+=4}},{key:"draw",value:function(e,t){e.beginPath(),e.fillStyle=this.color;var i=-.5*(this.size.x-1),n=this.pos.x+i+.125,r=this.pos.y+i+.125,a=this.size.x-.25,o=this.size.y-.25,s=n*t.cellSize+a*t.cellSize/2,l=r*t.cellSize+o*t.cellSize/2;[this.rotation*Math.PI/180,(this.rotation+45)*Math.PI/180].forEach((function(i){e.save(),e.translate(s,l),e.rotate(i),e.translate(-s,-l),e.rect(n*t.cellSize,r*t.cellSize,a*t.cellSize,o*t.cellSize),e.fill(),e.restore()}))}},{key:"debugDraw",value:function(e,t){e.beginPath(),e.globalAlpha=.3,e.fillStyle=m,e.arc((this.pos.x+.5)*t.cellSize,(this.pos.y+.5)*t.cellSize,this.size.x*t.cellSize/2,0,2*Math.PI),e.fill(),e.globalAlpha=1}}])&&Y(t.prototype,i),n&&Y(t,n),e}();function q(e,t){return new l(Math.floor(Math.random()*(e+1)),Math.floor(Math.random()*(t+1)))}function B(e,t,i){return e<t?t:e>i?i:e}function V(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function K(e){return(K="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Z(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function G(e,t){return!t||"object"!==K(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function J(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function N(e){return(N=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Q(e,t){return(Q=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var U=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Q(e,t)}(o,e);var t,i,n,r,a=(t=o,function(){var e,i=N(t);if(J()){var n=N(this).constructor;e=Reflect.construct(i,arguments,n)}else e=i.apply(this,arguments);return G(this,e)});function o(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(t=a.call(this,e)).shape=P,t.alpha=0,t.sign=0,t.rotation=e.rotation||0,t.startPos=t.pos,t.delay=e.delay,t.type="star",t}return i=o,(n=[{key:"update",value:function(e){if(this.delay>0)this.delay-=1;else{this.rotation+=4;var t=Math.sin(this.rotation/100);this.alpha=Math.abs(t);var i=Math.sign(t);this.size=new l(.16*this.alpha,.16*this.alpha),this.pos=new l(this.startPos.x-.08*this.alpha,this.startPos.y-.08*this.alpha);var n=e.getViewParams();Math.sign(t)!==this.sign&&(this.startPos=q(n.x[0]+e.canvasWidth/e.cellSize,e.canvasHeight/e.cellSize)),this.sign=i}}}])&&Z(i.prototype,n),r&&Z(i,r),o}(function(){function e(t){var i=t.pos,n=t.speed,r=t.size,a=t.color,o=t.name,s=t.strokeWidth,c=t.style,h=t.alpha;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.pos=i,this.speed=n||new l(0,0),this.size=r||new l(1,1),this.color=a||v,this.name=o||"",this.alpha=void 0!==h?h:1,this.options={strokeWidth:s||2,style:c||"stroke"}}var t,i,n;return t=e,(i=[{key:"act",value:function(e){}}])&&V(t.prototype,i),n&&V(t,n),e}());function $(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var ee=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.pos=t.pos,this.endTimer=80+70*Math.random(),this.timer=50*Math.random(),this.style="fill",this.color=d,this.updateOffset(),this.alpha=1,this.type="bubble"}var t,i,n;return t=e,(i=[{key:"act",value:function(){}},{key:"update",value:function(){this.timer<this.endTimer+30?(this.timer+=4,this.timer>this.endTimer&&(this.alpha-=.1)):(this.timer=0,this.endTimer=100+100*Math.random(),this.alpha=1,this.updateOffset())}},{key:"updateOffset",value:function(){this.offsetX=.6*Math.random()-.3}}])&&$(t.prototype,i),n&&$(t,n),e}();function te(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var ie={0:null,1:"wall",2:"lava"},ne={2:D,3:z,4:H,5:A,6:L},re=function(){function e(t,i){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var r=i.tiles;this.debug=t.config.debug,this.ctx=t.ctx,this.canvasWidth=t.gameWidth,this.canvasHeight=t.gameHeight,this.cellsX=r[0].length,this.cellsY=r.length,this.grid=[],this.actors=[],this.effects=[],this.playerHp=0,this.cameraX=0,this.cellSize=32,this.step=.016,this.checkSize=15;for(var a=0;a<this.cellsY;a++){for(var o=[],s=0;s<this.cellsX;s++){var c=r[a][s],h=ie[c]||null;"lava"===h&&this.effects.push(new ee({pos:new l(s,a)})),o.push(h)}this.grid.push(o)}i.actors.forEach((function(e){var t=ne[e.gid],i=e.x/n.cellSize,r=e.y/n.cellSize-1;n.actors.push(new t(new l(i,r),0))}));for(var u=0;u<20;u++)this.effects.push(new U({pos:q(this.cellsX,this.cellsY),size:new l(0,0),color:y,strokeWidth:1,rotation:0,delay:60*Math.random(),style:"fill"}))}var t,i,n;return t=e,(i=[{key:"animate",value:function(e){var t=this;this.actors.forEach((function(i){i.act(t,e)})),this.effects.forEach((function(e){e.act(t),e.update(t)}))}},{key:"obstacleAt",value:function(e,t){var i=Math.floor(e.x),n=Math.ceil(e.x+t.x),r=Math.floor(e.y),a=Math.ceil(e.y+t.y),o={actors:[],pos:{}},s={type:"wall",actors:["wall"]};if(i<0)return s.pos={x:-1,y:this.cellsY},s;if(n>this.cellsX)return s.pos={x:this.cellsX,y:this.cellsY},s;for(var l=r;l<a;l++)for(var c=i;c<n;c++){var h=this.grid[l][c];h&&(o.actors.push(this.grid[l][c]),o.type||(o.type=h,o.pos.x=c,o.pos.y=l))}return o}},{key:"actorAt",value:function(e){for(var t=this.cellSize,i=0;i<this.actors.length;i++){var n=this.actors[i];switch(n.shape){case"square":if(n!==e&&e.pos.x+e.size.x>n.pos.x&&e.pos.x<n.size.x+n.pos.x&&e.pos.y+e.size.y>n.pos.y&&e.pos.y<n.size.y+n.pos.y)return n;break;case"circle":var r=(n.pos.x+.5)*t,a=(n.pos.y+.5)*t,o=B(r,e.pos.x*t,e.pos.x*t+e.size.x*t),s=B(a,e.pos.y*t,e.pos.y*t+e.size.y*t);if(Math.pow(o-r,2)+Math.pow(s-a,2)<=Math.pow(.5*n.size.x*t,2))return n}}}},{key:"updateCamera",value:function(e){var t=e*this.cellSize,i=this.canvasWidth/2,n=this.cellsX*this.cellSize-i;t>i&&t<n?this.cameraX=Math.floor(i-t):t<n&&(this.cameraX=0)}},{key:"getViewParams",value:function(){if(this.cameraX<this.cellSize){var e=-Math.floor(this.cameraX/this.cellSize)-1;return{x:[e,this.canvasWidth/this.cellSize+e+1]}}return{x:[0,Math.floor(this.canvasWidth/this.cellSize)]}}}])&&te(t.prototype,i),n&&te(t,n),e}();function ae(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var oe={null:"transparent",wall:"black",lava:"#1cec82"},se=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.level=t,this.bg=new Image,this.bg.src="/img/bg/4.jpg",this.tile=new Image,this.tile.src="/img/tile.png",this.cameraX=0}var t,i,n;return t=e,(i=[{key:"drawBackground",value:function(e){for(var t=this.level.cellSize,i=this.level.grid.length,n=(this.level.grid[0].length,this.level.getViewParams()),r=0;r<i;r++)for(var a=n.x[0];a<n.x[1];a++){var o=this.level.grid[r][a];e.beginPath(),e.fillStyle=oe[o],"lava"===o?e.rect(a*t,r*t,t,t):"wall"===o&&e.drawImage(this.tile,a*t-2,r*t-2),e.fill()}}},{key:"drawActors",value:function(e){var t=this;this.level.actors.forEach((function(i){i.draw(e,t.level),t.level.debug&&i.debugDraw(e,t.level),i.touched=!1}))}},{key:"drawCheck",value:function(e){var t=this.level.checkSize;this.level.status?"win"===this.level.status&&(e.beginPath(),e.lineWidth="2",e.strokeStyle="#33f526",e.beginPath(),e.moveTo(2*t-this.level.cameraX,t),e.lineTo(t+5-this.level.cameraX,2*t-5),e.lineTo(t-this.level.cameraX,2*t-10),e.stroke()):(e.beginPath(),e.lineWidth="2",e.strokeStyle="red",e.beginPath(),e.moveTo(t-this.level.cameraX,t),e.lineTo(2*t-this.level.cameraX,2*t),e.moveTo(2*t-this.level.cameraX,t),e.lineTo(t-this.level.cameraX,2*t),e.stroke())}},{key:"drawHealthBar",value:function(e){var t=Math.max(0,100*this.level.playerHp/100);e.beginPath(),e.fillStyle="red",e.rect(51-this.level.cameraX,19,t-2,6),e.fill(),e.lineWidth="1",e.strokeStyle="#fff",e.rect(50-this.level.cameraX,18,100,8),e.stroke()}},{key:"drawEffects",value:function(e){var t=this;this.level.effects.forEach((function(i){switch(e.beginPath(),i.options&&"stroke"===i.options.style?(e.lineWidth=i.options.strokeWidth||2,e.strokeStyle=i.color):e.fillStyle=i.color,i.type){case"star":if("stroke"===i.options.style)e.rect(i.pos.x*t.level.cellSize,i.pos.y*t.level.cellSize,i.size.x*t.level.cellSize,i.size.y*t.level.cellSize),e.stroke();else{e.save(),e.globalAlpha=i.alpha;var n=i.pos.x*t.level.cellSize+i.size.x*t.level.cellSize/2,r=i.pos.y*t.level.cellSize+i.size.y*t.level.cellSize/2;e.translate(n,r),e.rotate(i.rotation*Math.PI/180),e.translate(-n,-r),e.fillRect(i.pos.x*t.level.cellSize,i.pos.y*t.level.cellSize,i.size.x*t.level.cellSize,i.size.y*t.level.cellSize),e.restore()}break;case"bubble":e.globalAlpha=i.alpha,e.beginPath(),e.fillStyle=i.color,e.arc((i.pos.x+.5+i.offsetX)*t.level.cellSize,i.pos.y*t.level.cellSize,i.timer/30,0,2*Math.PI),e.fill()}e.globalAlpha=1}))}},{key:"drawText",value:function(e){var t=this;e.font="14px Arial",e.fillStyle="white",e.textAlign="center",e.fillText("Тестовая площадка",450-this.level.cameraX,55),e.textAlign="left",e.font="12px Arial",["Управление ←, →, ↑, ↓","Z - ускорение","+ двойной прыжок","Сферы дают доп. прыжок"].forEach((function(i,n){e.fillText(i,15-t.level.cameraX,55+18*n)}))}},{key:"drawFrame",value:function(e){var t=this.level.ctx;t.save(),t.translate(this.level.cameraX,0),t.drawImage(this.bg,-this.level.cameraX,0),this.drawEffects(t),this.drawActors(t),this.drawBackground(t),this.drawCheck(t),this.drawHealthBar(t),this.drawText(t),t.restore()}}])&&ae(t.prototype,i),n&&ae(t,n),e}();function le(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var ce=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);this.keys=this.trackKeys({37:"left",38:"up",39:"right",90:"z"})}var t,i,n;return t=e,(i=[{key:"create",value:function(e){this.level=new re(e,e.maps[e.currentLevel]),this.display=new se(this.level)}},{key:"trackKeys",value:function(e){var t={},i=function(i){e.hasOwnProperty(i.keyCode)&&(t[e[i.keyCode]]="keydown"===i.type,i.preventDefault())};return addEventListener("keydown",i),addEventListener("keyup",i),t}},{key:"update",value:function(e){if(this.level.animate(this.keys),"lost"===this.level.status)return this.create(e),!1}},{key:"render",value:function(e){this.display.drawFrame(e)}}])&&le(t.prototype,i),n&&le(t,n),e}(),he=i(0),ue=[i.n(he).a],fe=new r(document.querySelector("canvas"),ue,{development:!1,debug:!1,scriptTime:!1});fe.addState("menu",o),fe.addState("game",ce),fe.runState("menu")}]);