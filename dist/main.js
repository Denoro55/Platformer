!function(t){var e={};function i(n){if(e[n])return e[n].exports;var r=e[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(n,r,function(e){return t[e]}.bind(null,r));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="dist",i(i.s=2)}([function(t,e,i){(function(t){function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var i;i={compressionlevel:-1,height:17,infinite:!1,layers:[{data:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,1,1,0,0,0,0,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,1,1,1,1,1,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1],height:17,id:1,name:"tiles",opacity:1,type:"tilelayer",visible:!0,width:36,x:0,y:0},{draworder:"topdown",id:2,name:"actors",objects:[{gid:3,height:32,id:1,name:"",rotation:0,type:"",visible:!0,width:32,x:96,y:480},{gid:2,height:32,id:2,name:"",rotation:0,type:"",visible:!0,width:32,x:461,y:480},{gid:4,height:32,id:3,name:"",rotation:0,type:"",visible:!0,width:32,x:207.333333333333,y:368},{gid:5,height:32,id:10,name:"",rotation:0,type:"",visible:!0,width:32,x:352,y:160},{gid:5,height:32,id:11,name:"",rotation:0,type:"",visible:!0,width:32,x:544,y:256},{gid:5,height:32,id:12,name:"",rotation:0,type:"",visible:!0,width:32,x:608,y:256},{gid:5,height:32,id:13,name:"",rotation:0,type:"",visible:!0,width:32,x:64,y:224},{gid:5,height:32,id:14,name:"",rotation:0,type:"",visible:!0,width:32,x:768,y:352},{gid:2,height:32,id:15,name:"",rotation:0,type:"",visible:!0,width:32,x:736,y:448},{gid:5,height:32,id:17,name:"",rotation:0,type:"",visible:!0,width:32,x:320,y:480},{gid:5,height:32,id:18,name:"",rotation:0,type:"",visible:!0,width:32,x:640,y:480},{gid:6,height:32,id:19,name:"",rotation:0,type:"",visible:!0,width:32,x:240,y:464},{gid:6,height:32,id:20,name:"",rotation:0,type:"",visible:!0,width:32,x:352,y:240},{gid:6,height:32,id:21,name:"",rotation:0,type:"",visible:!0,width:32,x:107.333333333333,y:339},{gid:6,height:32,id:22,name:"",rotation:0,type:"",visible:!0,width:32,x:607.666666666667,y:400},{gid:6,height:32,id:23,name:"",rotation:0,type:"",visible:!0,width:32,x:145,y:455},{gid:2,height:32,id:24,name:"",rotation:0,type:"",visible:!0,width:32,x:832,y:448},{gid:2,height:32,id:25,name:"",rotation:0,type:"",visible:!0,width:32,x:576,y:320}],opacity:1,type:"objectgroup",visible:!0,x:0,y:0}],nextlayerid:3,nextobjectid:35,orientation:"orthogonal",renderorder:"right-down",tiledversion:"1.3.3",tileheight:32,tilesets:[{firstgid:1,source:"../../../../../maps/tileset.tsx"}],tilewidth:32,type:"map",version:1.2,width:36},"undefined"==typeof onTileMapLoaded?("undefined"==typeof TileMaps&&(TileMaps={}),TileMaps.level2=i):onTileMapLoaded("level2",i),"object"===e(t)&&t&&t.exports&&(t.exports=i)}).call(this,i(1)(t))},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},function(t,e,i){"use strict";function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}i.r(e);var r=function(){function t(e,i,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.states={},this.activeState=null,this.canvas=e,this.ctx=this.canvas.getContext("2d"),this.gameWidth=this.canvas.width,this.gameHeight=this.canvas.height,this.maps=this.parseMaps(i),this.currentLevel=0,this.config=n}var e,i,r;return e=t,(i=[{key:"addState",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.states[t]=new e(this,i)}},{key:"runState",value:function(t){this.activeState=t,this.run()}},{key:"changeState",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.activeState=t,this.states[this.activeState].create(this,e)}},{key:"run",value:function(){var t=this;!function e(){t.ctx.clearRect(0,0,t.gameWidth,t.gameHeight);var i=performance.now();t.states[t.activeState].update(t),t.states[t.activeState].render(t),i=performance.now()-i,t.config.scriptTime&&console.log("Время выполнения = ",i),window.requestAnimationFrame(e)}()}},{key:"parseMaps",value:function(t){var e=[];return t.forEach((function(t){for(var i={tiles:[],actors:[]},n=t.layers.find((function(t){return"tiles"===t.name})),r=n.data,o=n.width,s=n.height,a=0;a<s;a++){for(var l=[],h=0;h<o;h++)l.push(r[a*o+h]);i.tiles.push(l)}t.layers.find((function(t){return"actors"===t.name})).objects.forEach((function(t){i.actors.push(t)})),e.push(i)})),e}}])&&n(e.prototype,i),r&&n(e,r),t}();function o(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var s=function(){function t(e,i){var n=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),addEventListener("keyup",(function(t){83===t.keyCode&&e.states[e.activeState]===n&&e.changeState("game")}))}var e,i,n;return e=t,(i=[{key:"update",value:function(){}},{key:"render",value:function(t){var e=t.ctx;e.font="18px Arial",e.fillStyle="white",e.textAlign="center",e.fillText('Нажмите "S", чтобы начать игру.',t.canvas.width/2,t.canvas.height/2)}}])&&o(e.prototype,i),n&&o(e,n),t}();function a(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var l=function(){function t(e,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.x=e,this.y=i}var e,i,n;return e=t,(i=[{key:"plus",value:function(e){return new t(this.x+e.x,this.y+e.y)}},{key:"times",value:function(e){return new t(this.x*e,this.y*e)}}])&&a(e.prototype,i),n&&a(e,n),t}();function h(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var c=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.animations=[],this.animationInterval=null,this.currentFrame=0,this.rotation=1}var e,i,n;return e=t,(i=[{key:"setSprite",value:function(t,e){this.image=new Image,this.image.src="/img/actors/".concat(t),this.spriteSize=e}},{key:"setAnimation",value:function(t,e,i){this.animations[t]={frames:e,speed:i}}},{key:"getCurrentAnimation",value:function(){return this.activeAnimation}},{key:"playAnimation",value:function(t){var e=this;if(this.getCurrentAnimation()!==t){clearTimeout(this.animationInterval);var i=this.animations[t],n=i.frames.length;this.activeAnimation=t,this.currentFrame=i.frames[(this.currentFrame+1)%n],this.animationInterval=setInterval((function(){e.currentFrame=i.frames[(e.currentFrame+1)%n]}),i.speed)}}},{key:"draw",value:function(t,e){this.rotation>0?t.drawImage(this.image,this.currentFrame*this.spriteSize,0,this.spriteSize-1,this.spriteSize,this.pos.x*e.size,this.pos.y*e.size,this.spriteSize,this.spriteSize):(t.save(),t.scale(-1,1),t.drawImage(this.image,this.currentFrame*this.spriteSize,0,this.spriteSize-1,this.spriteSize,-this.pos.x*e.size-this.size.x*e.size,this.pos.y*e.size,this.spriteSize,this.spriteSize),t.restore())}}])&&h(e.prototype,i),n&&h(e,n),t}(),u="black",f="yellow",p="#28ecec",y="red",d="white",v="blue",m="#1cec82",b="green";function g(t){return(g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function w(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function k(t,e){return!e||"object"!==g(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function x(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function z(t){return(z=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function S(t,e){return(S=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var j=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&S(t,e)}(s,t);var e,i,n,r,o=(e=s,function(){var t,i=z(e);if(x()){var n=z(this).constructor;t=Reflect.construct(i,arguments,n)}else t=i.apply(this,arguments);return k(this,t)});function s(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s),(e=o.call(this)).pos=t.plus(new l(.2,.2)),e.size=new l(.6,.6),e.speed=new l(0,0),e.color=u,e.touched=!1,e.touchedColor=y,e.hp=100,e.initialSpeed=6,e.speedX=e.initialSpeed,e.poisonTimer=0,e.setSprite("player.png",20),e.setAnimation("stand",[0,1],120),e.setAnimation("attacked",[2,3],120),e.setAnimation("poisoned",[4,5],120),e.playAnimation("stand"),e.initialOptions={jumpEnergy:15},e.gravity=28,e.jumped=!1,e.jumpForce=5,e.jumpsCount=1,e.jumpEnergy=e.initialOptions.jumpEnergy,e}return i=s,(n=[{key:"act",value:function(t,e){e.z?this.speedX=this.initialSpeed+2:this.speedX=this.initialSpeed,this.moveX(t,e),this.moveY(t,e);var i=t.actorAt(this);i&&this.collidesWithActors(t,[i]),this.poisonTimer>0?(this.poisonTimer-=1,this.hp-=.04,this.playAnimation("poisoned")):this.touched?this.playAnimation("attacked"):this.playAnimation("stand"),this.touched=!1,t.playerHp=this.hp}},{key:"moveX",value:function(t,e){this.speed.x=0,e.left&&(this.speed.x-=this.speedX,this.rotation=-1),e.right&&(this.speed.x+=this.speedX,this.rotation=1),t.updateCamera(this.pos.x);var i=new l(this.speed.x*t.step,0),n=this.pos.plus(i),r=t.obstacleAt(n,this.size);r.type?(this.collides(t,r.actors),this.speed.x>0?this.pos.x=r.pos.x-this.size.x:this.speed.x<0&&(this.pos.x=r.pos.x+1),this.speed.x=0):this.pos=n}},{key:"moveY",value:function(t,e){this.speed.y+=t.step*this.gravity;var i=new l(0,this.speed.y*t.step),n=this.pos.plus(i);n.y+this.size.y>t.height&&(t.status="lost"),!e.up&&this.jumped&&(this.jumpEnergy=0,this.jumped=!1,this.jumpsCount-=1);var r=t.obstacleAt(n,this.size);r.type?(this.collides(t,r.actors),this.jumpEnergy=0,this.speed.y>0?(this.jumped=!1,this.pos.y=r.pos.y-this.size.y,this.jumpEnergy=this.initialOptions.jumpEnergy,this.jumpsCount=2):this.pos.y=r.pos.y+1,this.speed.y=0,e.up&&!this.jumped&&this.jumpsCount>0&&(this.jumpEnergy=this.initialOptions.jumpEnergy,this.jumped=!0,this.speed.y=-this.jumpForce)):(e.up&&(!this.jumped&&this.jumpsCount>0&&(this.jumpEnergy=this.initialOptions.jumpEnergy,this.jumped=!0),this.jumpEnergy>0&&(this.speed.y=-this.jumpForce-2,this.jumpEnergy-=1)),this.pos=n)}},{key:"collidesWithActors",value:function(t,e){var i=this;e.forEach((function(e){switch(e.type){case"coin":t.actors=t.actors.filter((function(t){return t!==e})),t.actors.some((function(t){return"coin"===t.type}))||(t.status="win");break;case"sphere":e.activate(i);break;case"enemy":i.touched=!0,i.hp-=e.damage}})),this.hp<=0&&(t.status="lost")}},{key:"collides",value:function(t,e){var i=this;e.forEach((function(t){switch(t){case"lava":i.poisonTimer=1200,i.touched=!0,i.hp-=1}})),this.hp<=0&&(t.status="lost")}},{key:"debugDraw",value:function(t,e){}}])&&w(i.prototype,n),r&&w(i,r),s}(c),P="circle",O="square",E="coin",T="enemy",M="sphere";function A(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var C=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.pos=this.basePos=e.plus(new l(.25,.55)),this.size=new l(.5,.5),this.wobble=Math.random()*Math.PI*2,this.type=E,this.color=f,this.shape=O}var e,i,n;return e=t,(i=[{key:"act",value:function(t){this.wobble+=7*t.step;var e=.1*Math.sin(this.wobble);this.pos=this.basePos.plus(new l(0,e))}},{key:"draw",value:function(t,e){t.beginPath(),t.fillStyle=this.color,t.rect(this.pos.x*e.size,this.pos.y*e.size,this.size.x*e.size,this.size.y*e.size),t.fill()}},{key:"debugDraw",value:function(t,e){}}])&&A(e.prototype,i),n&&A(e,n),t}();function _(t){return(_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function X(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function R(t,e){return!e||"object"!==_(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function I(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function D(t){return(D=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function F(t,e){return(F=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var W=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&F(t,e)}(s,t);var e,i,n,r,o=(e=s,function(){var t,i=D(e);if(I()){var n=D(this).constructor;t=Reflect.construct(i,arguments,n)}else t=i.apply(this,arguments);return R(this,t)});function s(t,e){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s),(i=o.call(this)).pos=t,i.size=new l(1,1),i.speed=new l(1.3,0),i.damage=1,i.type=T,i.shape=O,i.color=u,i.setSprite("enemy.png",32),i.setAnimation("stand",[0,1],120),i.playAnimation("stand"),i}return i=s,(n=[{key:"act",value:function(t,e){this.moveX(t,e),this.moveY(t,e)}},{key:"moveX",value:function(t){var e=this.pos.plus(this.speed.times(t.step));t.obstacleAt(e,this.size).type?this.changeDirection():this.pos=e}},{key:"moveY",value:function(t){var e=this.speed.x>0?1:-1,i=this.pos.plus(new l(this.size.x*e,this.size.y));t.obstacleAt(i,this.size).type||this.changeDirection()}},{key:"changeDirection",value:function(){this.speed=this.speed.times(-1),this.rotation=Math.sign(this.speed.x)}},{key:"debugDraw",value:function(t,e){}}])&&X(i.prototype,n),r&&X(i,r),s}(c);function H(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var L=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.pos=this.basePos=e.plus(new l(0,.55)),this.size=new l(.25,.25),this.wobble=Math.random()*Math.PI*2,this.reloadTime=150,this.timer=-1,this.type=M,this.color=p,this.shape=P}var e,i,n;return e=t,(i=[{key:"act",value:function(t){this.wobble+=7*t.step;var e=.1*Math.sin(this.wobble);this.pos=this.basePos.plus(new l(0,e)),this.timer>-1&&(this.timer-=1)}},{key:"activate",value:function(t){-1===this.timer&&(t.jumpsCount+=1,this.timer=this.reloadTime)}},{key:"draw",value:function(t,e){t.globalAlpha=-1===this.timer?1:0,t.beginPath(),t.fillStyle=this.color,t.arc((this.pos.x+.5)*e.size,(this.pos.y+.5)*e.size,4,0,2*Math.PI),t.fill(),t.globalAlpha=1}},{key:"debugDraw",value:function(t,e){}}])&&H(e.prototype,i),n&&H(e,n),t}();function q(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var B=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.pos=e,this.size=new l(1,1),this.rotation=0,this.color=u,this.shape=P,this.type=T,this.damage=1}var e,i,n;return e=t,(i=[{key:"act",value:function(t){this.rotation+=4}},{key:"draw",value:function(t,e){t.beginPath(),t.fillStyle=this.color;var i=-.5*(this.size.x-1),n=this.pos.x+i+.125,r=this.pos.y+i+.125,o=this.size.x-.25,s=this.size.y-.25,a=n*e.size+o*e.size/2,l=r*e.size+s*e.size/2;[this.rotation*Math.PI/180,(this.rotation+45)*Math.PI/180].forEach((function(i){t.save(),t.translate(a,l),t.rotate(i),t.translate(-a,-l),t.rect(n*e.size,r*e.size,o*e.size,s*e.size),t.fill(),t.restore()}))}},{key:"debugDraw",value:function(t,e){t.beginPath(),t.globalAlpha=.3,t.fillStyle=b,t.arc((this.pos.x+.5)*e.size,(this.pos.y+.5)*e.size,this.size.x*e.size/2,0,2*Math.PI),t.fill(),t.globalAlpha=1}}])&&q(e.prototype,i),n&&q(e,n),t}();function Y(t,e){return new l(Math.floor(Math.random()*(t+1)),Math.floor(Math.random()*(e+1)))}function K(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Z(t){return(Z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function G(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function J(t,e){return!e||"object"!==Z(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function N(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function Q(t){return(Q=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function U(t,e){return(U=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var V=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&U(t,e)}(s,t);var e,i,n,r,o=(e=s,function(){var t,i=Q(e);if(N()){var n=Q(this).constructor;t=Reflect.construct(i,arguments,n)}else t=i.apply(this,arguments);return J(this,t)});function s(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s),(e=o.call(this,t)).shape=O,e.alpha=0,e.sign=0,e.rotation=t.rotation||0,e.startPos=e.pos,e.delay=t.delay,e.type="star",e}return i=s,(n=[{key:"update",value:function(t){if(this.delay>0)this.delay-=1;else{this.rotation+=4;var e=Math.sin(this.rotation/100);this.alpha=Math.abs(e);var i=Math.sign(e);this.size=new l(.16*this.alpha,.16*this.alpha),this.pos=new l(this.startPos.x-.08*this.alpha,this.startPos.y-.08*this.alpha),Math.sign(e)!==this.sign&&(this.startPos=Y(t.width,t.height)),this.sign=i}}}])&&G(i.prototype,n),r&&G(i,r),s}(function(){function t(e){var i=e.pos,n=e.speed,r=e.size,o=e.color,s=e.name,a=e.strokeWidth,h=e.style,c=e.alpha;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.pos=i,this.speed=n||new l(0,0),this.size=r||new l(1,1),this.color=o||v,this.name=s||"",this.alpha=void 0!==c?c:1,this.options={strokeWidth:a||2,style:h||"stroke"}}var e,i,n;return e=t,(i=[{key:"act",value:function(t){}}])&&K(e.prototype,i),n&&K(e,n),t}());function $(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var tt=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.pos=e.pos,this.endTimer=80+70*Math.random(),this.timer=50*Math.random(),this.style="fill",this.color=m,this.updateOffset(),this.alpha=1,this.type="bubble"}var e,i,n;return e=t,(i=[{key:"act",value:function(){}},{key:"update",value:function(){this.timer<this.endTimer+30?(this.timer+=4,this.timer>this.endTimer&&(this.alpha-=.1)):(this.timer=0,this.endTimer=100+100*Math.random(),this.alpha=1,this.updateOffset())}},{key:"updateOffset",value:function(){this.offsetX=.6*Math.random()-.3}}])&&$(e.prototype,i),n&&$(e,n),t}();function et(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var it={0:null,1:"wall",2:"lava"},nt={2:W,3:j,4:L,5:C,6:B};function rt(t,e,i){return t<e?e:t>i?i:t}var ot=function(){function t(e,i){var n=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);var r=i.tiles;this.debug=!1,this.ctx=e.ctx,this.width=r[0].length,this.height=r.length,this.grid=[],this.actors=[],this.effects=[],this.fail=!1,this.playerHp=0,this.cameraX=0,this.checkSize=15,this.size=32,this.step=.016;for(var o=0;o<this.height;o++){for(var s=[],a=0;a<this.width;a++){var h=r[o][a],c=it[h]||null;"lava"===c&&this.effects.push(new tt({pos:new l(a,o),size:new l(1,1),color:d,strokeWidth:1,rotation:0,delay:60*Math.random(),style:"fill"})),s.push(c)}this.grid.push(s)}i.actors.forEach((function(t){var e=nt[t.gid],i=t.x/n.size,r=t.y/n.size-1;n.actors.push(new e(new l(i,r),0))}));for(var u=0;u<20;u++)this.effects.push(new V({pos:Y(this.width,this.height),size:new l(0,0),color:d,strokeWidth:1,rotation:0,delay:60*Math.random(),style:"fill"}))}var e,i,n;return e=t,(i=[{key:"animate",value:function(t){var e=this;this.actors.forEach((function(i){i.act(e,t)})),this.effects.forEach((function(t){t.act(e),t.update(e)}))}},{key:"obstacleAt",value:function(t,e){var i=Math.floor(t.x),n=Math.ceil(t.x+e.x),r=Math.floor(t.y),o=Math.ceil(t.y+e.y),s={actors:[],pos:{}},a={type:"wall",actors:["wall"]};if(i<0)return a.pos={x:-1,y:this.height},a;if(n>this.width)return a.pos={x:this.width,y:this.height},a;for(var l=r;l<o;l++)for(var h=i;h<n;h++){var c=this.grid[l][h];c&&(s.actors.push(this.grid[l][h]),s.type||(s.type=c,s.pos.x=h,s.pos.y=l))}return s}},{key:"actorAt",value:function(t){for(var e=this.size,i=0;i<this.actors.length;i++){var n=this.actors[i];switch(n.shape){case"square":if(n!==t&&t.pos.x+t.size.x>n.pos.x&&t.pos.x<n.size.x+n.pos.x&&t.pos.y+t.size.y>n.pos.y&&t.pos.y<n.size.y+n.pos.y)return n;break;case"circle":var r=(n.pos.x+.5)*e,o=(n.pos.y+.5)*e,s=rt(r,t.pos.x*e,t.pos.x*e+t.size.x*e),a=rt(o,t.pos.y*e,t.pos.y*e+t.size.y*e);if(Math.pow(s-r,2)+Math.pow(a-o,2)<=Math.pow(.5*n.size.x*e,2))return n}}}},{key:"updateCamera",value:function(t){t>this.width/2?this.cameraX=Math.floor((this.width/2-t)*this.size):this.cameraX=0}}])&&et(e.prototype,i),n&&et(e,n),t}();function st(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var at={null:"transparent",wall:"black",lava:"#1cec82"},lt=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.level=e,this.bg=new Image,this.bg.src="/img/bg/4.jpg",this.tile=new Image,this.tile.src="/img/tile.png",this.cameraX=0}var e,i,n;return e=t,(i=[{key:"drawBackground",value:function(t){for(var e=this.level.size,i=this.level.grid.length,n=this.level.grid[0].length,r=0;r<i;r++)for(var o=0;o<n;o++){var s=this.level.grid[r][o];t.beginPath(),t.fillStyle=at[s],"lava"===s?t.rect(o*e,r*e,e,e):"wall"===s&&t.drawImage(this.tile,o*e-2,r*e-2),t.fill()}}},{key:"drawActors",value:function(t){var e=this;this.level.actors.forEach((function(i){i.draw(t,e.level),e.level.debug&&i.debugDraw(t,e.level),i.touched=!1}))}},{key:"drawCheck",value:function(t){var e=this.level.checkSize;this.level.status?"win"===this.level.status&&(t.beginPath(),t.lineWidth="2",t.strokeStyle="#33f526",t.beginPath(),t.moveTo(2*e-this.level.cameraX,e),t.lineTo(e+5-this.level.cameraX,2*e-5),t.lineTo(e,2*e-10),t.stroke()):(t.beginPath(),t.lineWidth="2",t.strokeStyle="red",t.beginPath(),t.moveTo(e-this.level.cameraX,e),t.lineTo(2*e-this.level.cameraX,2*e),t.moveTo(2*e-this.level.cameraX,e),t.lineTo(e-this.level.cameraX,2*e),t.stroke())}},{key:"drawHealthBar",value:function(t){var e=Math.max(0,100*this.level.playerHp/100);t.beginPath(),t.fillStyle="red",t.rect(51-this.level.cameraX,19,e-2,6),t.fill(),t.lineWidth="1",t.strokeStyle="#fff",t.rect(50-this.level.cameraX,18,100,8),t.stroke()}},{key:"drawEffects",value:function(t){var e=this;this.level.effects.forEach((function(i){switch(t.beginPath(),i.options&&"stroke"===i.options.style?(t.lineWidth=i.options.strokeWidth||2,t.strokeStyle=i.color):t.fillStyle=i.color,i.type){case"star":if("stroke"===i.options.style)t.rect(i.pos.x*e.level.size,i.pos.y*e.level.size,i.size.x*e.level.size,i.size.y*e.level.size),t.stroke();else{t.save(),t.globalAlpha=i.alpha;var n=i.pos.x*e.level.size+i.size.x*e.level.size/2,r=i.pos.y*e.level.size+i.size.y*e.level.size/2;t.translate(n,r),t.rotate(i.rotation*Math.PI/180),t.translate(-n,-r),t.fillRect(i.pos.x*e.level.size,i.pos.y*e.level.size,i.size.x*e.level.size,i.size.y*e.level.size),t.restore()}break;case"bubble":t.globalAlpha=i.alpha,t.beginPath(),t.fillStyle=i.color,t.arc((i.pos.x+.5+i.offsetX)*e.level.size,i.pos.y*e.level.size,i.timer/30,0,2*Math.PI),t.fill()}t.globalAlpha=1}))}},{key:"drawText",value:function(t){var e=this;t.font="14px Arial",t.fillStyle="white",t.textAlign="center",t.fillText("Тестовая площадка",450-this.level.cameraX,55),t.textAlign="left",t.font="12px Arial",["Управление ←, →, ↑, ↓","Z - ускорение","+ двойной прыжок","Сферы дают доп. прыжок"].forEach((function(i,n){t.fillText(i,15-e.level.cameraX,55+18*n)}))}},{key:"drawFrame",value:function(t){var e=this.level.ctx;e.save(),e.translate(this.level.cameraX,0),e.drawImage(this.bg,-this.level.cameraX,0),this.drawEffects(e),this.drawActors(e),this.drawBackground(e),this.drawCheck(e),this.drawHealthBar(e),this.drawText(e),e.restore()}}])&&st(e.prototype,i),n&&st(e,n),t}();function ht(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var ct=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);this.keys=this.trackKeys({37:"left",38:"up",39:"right",90:"z"})}var e,i,n;return e=t,(i=[{key:"create",value:function(t){this.level=new ot(t,t.maps[t.currentLevel]),this.display=new lt(this.level)}},{key:"trackKeys",value:function(t){var e={},i=function(i){t.hasOwnProperty(i.keyCode)&&(e[t[i.keyCode]]="keydown"===i.type,i.preventDefault())};return addEventListener("keydown",i),addEventListener("keyup",i),e}},{key:"update",value:function(t){if(this.level.animate(this.keys),"lost"===this.level.status)return this.create(t),!1}},{key:"render",value:function(t){this.display.drawFrame(t)}}])&&ht(e.prototype,i),n&&ht(e,n),t}(),ut=i(0),ft=[i.n(ut).a],pt=new r(document.querySelector("canvas"),ft,{development:!1,debug:!1,scriptTime:!1});pt.addState("menu",s),pt.addState("game",ct),pt.runState("menu")}]);