!function(e){var t={};function i(n){if(t[n])return t[n].exports;var s=t[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,i),s.l=!0,s.exports}i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)i.d(n,s,function(t){return e[t]}.bind(null,s));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="dist",i(i.s=0)}([function(e,t,i){"use strict";function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}i.r(t);var s=function(){function e(t,i,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.states={},this.activeState=null,this.canvas=t,this.ctx=this.canvas.getContext("2d"),this.gameWidth=this.canvas.width,this.gameHeight=this.canvas.height,this.maps=i,this.currentLevel=0,this.config=n}var t,i,s;return t=e,(i=[{key:"addState",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.states[e]=new t(this,i)}},{key:"runState",value:function(e){this.activeState=e,this.run()}},{key:"changeState",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.activeState=e,this.states[this.activeState].create(this,t)}},{key:"run",value:function(){var e=this;!function t(){e.ctx.clearRect(0,0,e.gameWidth,e.gameHeight);var i=performance.now();e.states[e.activeState].update(e),e.states[e.activeState].render(e),i=performance.now()-i,e.config.scriptTime&&console.log("Время выполнения = ",i),window.requestAnimationFrame(t)}()}}])&&n(t.prototype,i),s&&n(t,s),e}();function a(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var o=function(){function e(t,i){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),addEventListener("keyup",(function(e){83===e.keyCode&&t.states[t.activeState]===n&&(console.log("state game run"),t.changeState("game"))}))}var t,i,n;return t=e,(i=[{key:"update",value:function(){}},{key:"render",value:function(e){var t=e.ctx;t.font="18px Arial",t.fillStyle="white",t.textAlign="center",t.fillText('Нажмите "S", чтобы начать игру.',e.canvas.width/2,e.canvas.height/2)}}])&&a(t.prototype,i),n&&a(t,n),e}();function r(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var l=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.x=t,this.y=i}var t,i,n;return t=e,(i=[{key:"plus",value:function(t){return new e(this.x+t.x,this.y+t.y)}},{key:"times",value:function(t){return new e(this.x*t,this.y*t)}}])&&r(t.prototype,i),n&&r(t,n),e}();function h(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var u=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.pos=t.plus(new l(.2,.2)),this.size=new l(.6,.6),this.speed=new l(0,0),this.color="blue",this.touched=!1,this.touchedColor="red",this.speedX=6,this.gravity=28,this.jumpForce=13}var t,i,n;return t=e,(i=[{key:"act",value:function(e,t){this.moveX(e,t),this.moveY(e,t);var i=e.actorAt(this);i&&(i.touched=!0,e.playerTouched(i))}},{key:"moveX",value:function(e,t){this.speed.x=0,t.left&&(this.speed.x-=this.speedX),t.right&&(this.speed.x+=this.speedX);var i=new l(this.speed.x*e.step,0),n=this.pos.plus(i),s=e.obstacleAt(n,this.size);s.type?(this.collides(e,s),e.playerTouched(s.type),this.speed.x>0?this.pos.x=s.pos.x-this.size.x:this.speed.x<0&&(this.pos.x=s.pos.x+1),this.speed.x=0):this.pos=n}},{key:"moveY",value:function(e,t){this.speed.y+=e.step*this.gravity;var i=new l(0,this.speed.y*e.step),n=this.pos.plus(i);n.y+this.size.y>e.height-1&&(e.status="lost");var s=e.obstacleAt(n,this.size);s.type?(this.collides(e,s),e.playerTouched(s.type),t.up&&this.speed.y>0?this.speed.y=-this.jumpForce:(this.speed.y>0&&(this.pos.y=s.pos.y-this.size.y),this.speed.y=0)):this.pos=n}},{key:"collides",value:function(e,t){t.actors.forEach((function(t){"lava"===t&&(e.status="lost")}))}}])&&h(t.prototype,i),n&&h(t,n),e}();function c(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var v=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.pos=this.basePos=t.plus(new l(.25,.55)),this.size=new l(.5,.5),this.speed=new l(0,0),this.wobble=Math.random()*Math.PI*2,this.color="yellow",this.touched=!1,this.touchedColor="red",this.type="coin"}var t,i,n;return t=e,(i=[{key:"act",value:function(e,t){this.wobble+=7*e.step;var i=.1*Math.sin(this.wobble);this.pos=this.basePos.plus(new l(0,i))}}])&&c(t.prototype,i),n&&c(t,n),e}();function f(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var p=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.pos=t,this.size=new l(1,1),this.speed=new l("v"===i?1.3:-1.3,0),this.color="red",this.touched=!1,this.touchedColor="red",this.type="lava"}var t,i,n;return t=e,(i=[{key:"act",value:function(e,t){this.moveX(e,t),this.moveY(e,t)}},{key:"moveX",value:function(e,t){var i=this.pos.plus(this.speed.times(.005));e.obstacleAt(i,this.size).type?this.speed=this.speed.times(-1):this.pos=i}},{key:"moveY",value:function(e,t){var i=this.speed.x>0?1:-1,n=this.pos.plus(new l(this.size.x*i,this.size.y));e.obstacleAt(n,this.size).type||(this.speed=this.speed.times(-1))}}])&&f(t.prototype,i),n&&f(t,n),e}();function y(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var d={" ":null,x:"wall","!":"lava"},x={"@":u,o:v,v:p,V:p},g=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.ctx=t.ctx,this.width=i[0].length,this.height=i.length,this.grid=[],this.actors=[],this.fail=!1,this.checkSize=15,this.size=35,this.step=.016;for(var n=0;n<this.height;n++){for(var s=[],a=0;a<this.width;a++){var o=i[n][a],r=x[o];r&&this.actors.push(new r(new l(a,n),o));var h=d[o]||null;s.push(h)}this.grid.push(s)}console.log(this.grid,this.actors)}var t,i,n;return t=e,(i=[{key:"animate",value:function(e){var t=this;this.actors.forEach((function(i){i.act(t,e)}))}},{key:"obstacleAt",value:function(e,t){var i=Math.floor(e.x),n=Math.ceil(e.x+t.x),s=Math.floor(e.y),a=Math.ceil(e.y+t.y),o={actors:[],pos:{}};if(i<0||n>this.width||s<0||s>this.height)return"wall";for(var r=s;r<a;r++)for(var l=i;l<n;l++){var h=this.grid[r][l];h&&(o.actors.push(this.grid[r][l]),o.type||(o.type=h,o.pos.x=l,o.pos.y=r))}return o}},{key:"actorAt",value:function(e){for(var t=0;t<this.actors.length;t++){var i=this.actors[t];if(i!==e&&e.pos.x+e.size.x>i.pos.x&&e.pos.x<i.size.x+i.pos.x&&e.pos.y+e.size.y>i.pos.y&&e.pos.y<i.size.y+i.pos.y)return i}}},{key:"playerTouched",value:function(e){"coin"===e.type?(this.actors=this.actors.filter((function(t){return t!==e})),this.actors.some((function(e){return"coin"===e.type}))||(this.status="win")):"lava"===e.type&&(this.status="lost")}}])&&y(t.prototype,i),n&&y(t,n),e}();function b(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var w={null:"transparent",wall:"white",player:"blue",coin:"yellow",lava:"red"},m=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.level=t}var t,i,n;return t=e,(i=[{key:"drawBackground",value:function(e){var t=this.level.checkSize,i=this.level.size,n=this.level.grid.length,s=this.level.grid[0].length;this.level.status?"win"===this.level.status&&(e.beginPath(),e.lineWidth="2",e.strokeStyle="#33f526",e.beginPath(),e.moveTo(2*t,t),e.lineTo(t+5,2*t-5),e.lineTo(t,2*t-10),e.stroke()):(e.beginPath(),e.lineWidth="2",e.strokeStyle="red",e.beginPath(),e.moveTo(t,t),e.lineTo(2*t,2*t),e.moveTo(2*t,t),e.lineTo(t,2*t),e.stroke());for(var a=0;a<n;a++)for(var o=0;o<s;o++){var r=this.level.grid[a][o];e.beginPath(),e.lineWidth="2",e.strokeStyle=w[r],e.rect(o*i,a*i,i,i),e.stroke()}}},{key:"drawActors",value:function(e){var t=this.level.size;this.level.actors.forEach((function(i){e.beginPath(),e.lineWidth="2",e.strokeStyle=i.touched?i.touchedColor:i.color,e.rect(i.pos.x*t,i.pos.y*t,i.size.x*t,i.size.y*t),e.stroke(),i.touched=!1}))}},{key:"drawCheck",value:function(e){var t=this.level.checkSize;this.level.status?"win"===this.level.status&&(e.beginPath(),e.lineWidth="2",e.strokeStyle="#33f526",e.beginPath(),e.moveTo(2*t,t),e.lineTo(t+5,2*t-5),e.lineTo(t,2*t-10),e.stroke()):(e.beginPath(),e.lineWidth="2",e.strokeStyle="red",e.beginPath(),e.moveTo(t,t),e.lineTo(2*t,2*t),e.moveTo(2*t,t),e.lineTo(t,2*t),e.stroke())}},{key:"drawFrame",value:function(e){var t=this.level.ctx;t.clearRect(0,0,e.gameWidth,e.gameHeight),this.drawActors(t),this.drawBackground(t),this.drawCheck(t)}}])&&b(t.prototype,i),n&&b(t,n),e}();function k(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var T,S,P=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,i,n;return t=e,(i=[{key:"create",value:function(e){this.level=new g(e,e.maps[e.currentLevel]),this.display=new m(this.level),this.keys=this.trackKeys({37:"left",38:"up",39:"right"})}},{key:"trackKeys",value:function(e){var t={},i=function(i){if(e.hasOwnProperty(i.keyCode)){var n="keydown"===i.type;t[e[i.keyCode]]=n,i.preventDefault()}};return addEventListener("keydown",i),addEventListener("keyup",i),t}},{key:"update",value:function(e){}},{key:"render",value:function(e){this.display.drawFrame(e),this.level.animate(this.keys)}}])&&k(t.prototype,i),n&&k(t,n),e}();T="maps.json",(S=new XMLHttpRequest).open("GET",T,!1),S.onreadystatechange=function(){if(4===S.readyState&&(200===S.status||0===S.status)){var e=S.responseText;console.log(e)}},S.send(null);var z=new s(document.querySelector("canvas"),[["               o       ","          o            ","x     !       v      xx","x o          x!x!x    x","x     v               x","x    xx!x  v      v   x","xv     o   xxx o xxx  x","xxx          !   !   ox","x     V   !! o   o !  x","x @  xxx              x","x    xxx   V     v    x","xxxxxxxxxxxxxxxxxxxxxxx","xxxxxxxxxxxxxxxxxxxxxxx"]],{development:!1,debug:!0,scriptTime:!1});z.addState("menu",o),z.addState("game",P),z.runState("menu")}]);